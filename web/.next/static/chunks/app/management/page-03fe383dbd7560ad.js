(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[393],{821:function(e,t,r){Promise.resolve().then(r.bind(r,2716))},357:function(e,t,r){"use strict";var n,o;e.exports=(null==(n=r.g.process)?void 0:n.env)&&"object"==typeof(null==(o=r.g.process)?void 0:o.env)?r.g.process:r(8081)},8081:function(e){!function(){var t={229:function(e){var t,r,n,o=e.exports={};function i(){throw Error("setTimeout has not been defined")}function d(){throw Error("clearTimeout has not been defined")}function l(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:i}catch(e){t=i}try{r="function"==typeof clearTimeout?clearTimeout:d}catch(e){r=d}}();var a=[],s=!1,c=-1;function u(){s&&n&&(s=!1,n.length?a=n.concat(a):c=-1,a.length&&p())}function p(){if(!s){var e=l(u);s=!0;for(var t=a.length;t;){for(n=a,a=[];++c<t;)n&&n[c].run();c=-1,t=a.length}n=null,s=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===d||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function x(){}o.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];a.push(new h(e,t)),1!==a.length||s||l(p)},h.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=x,o.addListener=x,o.once=x,o.off=x,o.removeListener=x,o.removeAllListeners=x,o.emit=x,o.prependListener=x,o.prependOnceListener=x,o.listeners=function(e){return[]},o.binding=function(e){throw Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw Error("process.chdir is not supported")},o.umask=function(){return 0}}},r={};function n(e){var o=r[e];if(void 0!==o)return o.exports;var i=r[e]={exports:{}},d=!0;try{t[e](i,i.exports,n),d=!1}finally{d&&delete r[e]}return i.exports}n.ab="//";var o=n(229);e.exports=o}()},2716:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return l}});var n=r(7437),o=r(2265),i=r(2800);let d=r(357).env.NEXT_PUBLIC_API_BASE||"http://127.0.0.1:8000";function l(){let[e,t]=(0,o.useState)([]),[r,l]=(0,o.useState)([]),[a,s]=(0,o.useState)(!1),[c,u]=(0,o.useState)("collections"),[p,h]=(0,o.useState)("ict_docs"),[x,f]=(0,o.useState)("qwen"),[g,y]=(0,o.useState)("text-embedding-v2"),[b,m]=(0,o.useState)(""),[j,v]=(0,o.useState)(""),[D,C]=(0,o.useState)("ict_docs"),[w,k]=(0,o.useState)("qwen"),[S,B]=(0,o.useState)("text-embedding-v2"),[R,T]=(0,o.useState)(3),[A,_]=(0,o.useState)("");async function O(){try{let e=await (0,i.bG)(d);t(e.collections||[])}catch(e){console.error("加载集合失败:",e)}}async function P(){try{let e=await (0,i.XP)(d);l(e.evals||[])}catch(e){console.error("加载评测结果失败:",e)}}async function I(){if(!b.trim()){alert("请输入要索引的文档内容");return}s(!0);try{let e=b.split("\n\n").filter(e=>e.trim()).map((e,t)=>({id:"doc_".concat(Date.now(),"_").concat(t),text:e.trim(),meta:{source:"manual",timestamp:new Date().toISOString()}}));await (0,i.Iu)(d,{collection:p,provider:x,model:g,docs:e}),alert("文档索引完成！"),m(""),O()}catch(e){console.error("索引失败:",e),alert("索引失败，请检查API状态")}finally{s(!1)}}async function E(){if(!j.trim()){alert("请输入要索引的URL列表");return}s(!0);try{let e=j.split("\n").filter(e=>e.trim());await (0,i.Iu)(d,{collection:p,provider:x,model:g,urls:e}),alert("URL索引完成！"),v(""),O()}catch(e){console.error("索引失败:",e),alert("索引失败，请检查API状态")}finally{s(!1)}}async function N(e){if(confirm('确定要删除集合 "'.concat(e,'" 吗？此操作不可恢复！'))){s(!0);try{await (0,i.P4)(d,e),alert("集合删除成功！"),O()}catch(e){console.error("删除失败:",e),alert("删除失败，请检查API状态")}finally{s(!1)}}}async function L(e){if(confirm('确定要重置集合 "'.concat(e,'" 的BM25索引吗？'))){s(!0);try{await (0,i.zK)(d,e),alert("BM25索引重置成功！")}catch(e){console.error("重置失败:",e),alert("重置失败，请检查API状态")}finally{s(!1)}}}async function W(){if(!A.trim()){alert("请输入评测样本（JSON格式）");return}s(!0);try{let e;try{e=JSON.parse(A)}catch(e){alert("评测样本格式错误，请检查JSON格式");return}let t={collection:D,provider:w,model:S,topk:Number(R),samples:e};await (0,i.BC)(d,t),alert("评测完成！"),P()}catch(e){console.error("评测失败:",e),alert("评测失败，请检查API状态")}finally{s(!1)}}async function U(e){try{let t=await (0,i.KK)(d,e),r=new Blob([t],{type:"text/csv"}),n=window.URL.createObjectURL(r),o=document.createElement("a");o.href=n,o.download="".concat(e,"_eval_").concat(new Date().toISOString().split("T")[0],".csv"),o.click(),window.URL.revokeObjectURL(n)}catch(e){console.error("下载失败:",e),alert("下载失败，请检查API状态")}}return(0,o.useEffect)(()=>{O(),P()},[]),(0,n.jsxs)("main",{style:{maxWidth:1400,margin:"0 auto",padding:24},children:[(0,n.jsx)("h1",{children:"\uD83D\uDD27 ICT选型助手 - 数据管理"}),(0,n.jsx)("div",{style:{marginBottom:24},children:(0,n.jsx)("div",{style:{display:"flex",gap:2,borderBottom:"1px solid #d0d7de"},children:[{id:"collections",name:"\uD83D\uDCDA 集合管理",icon:"\uD83D\uDCDA"},{id:"index",name:"\uD83D\uDCDD 文档索引",icon:"\uD83D\uDCDD"},{id:"evaluate",name:"\uD83D\uDCCA 质量评测",icon:"\uD83D\uDCCA"},{id:"results",name:"\uD83D\uDCC8 评测结果",icon:"\uD83D\uDCC8"}].map(e=>(0,n.jsx)("button",{onClick:()=>u(e.id),style:{padding:"12px 24px",border:"none",backgroundColor:c===e.id?"#0969da":"transparent",color:c===e.id?"white":"#656d76",borderRadius:"8px 8px 0 0",cursor:"pointer",fontWeight:c===e.id?600:400},children:e.name},e.id))})}),"collections"===c&&(0,n.jsx)("section",{children:(0,n.jsxs)("div",{style:{border:"1px solid #e1e5e9",padding:20,borderRadius:12,backgroundColor:"#fafbfc"},children:[(0,n.jsx)("h3",{style:{color:"#24292f",marginBottom:16},children:"\uD83D\uDCDA 向量集合管理"}),(0,n.jsx)("div",{style:{display:"flex",gap:12,marginBottom:16},children:(0,n.jsx)("button",{onClick:O,disabled:a,style:{padding:"8px 16px",backgroundColor:"#0969da",color:"white",border:"none",borderRadius:6,cursor:a?"not-allowed":"pointer"},children:"\uD83D\uDD04 刷新列表"})}),e.length>0?(0,n.jsx)("div",{style:{background:"#ffffff",borderRadius:8,border:"1px solid #d0d7de",overflow:"hidden"},children:(0,n.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[(0,n.jsx)("thead",{style:{backgroundColor:"#f6f8fa"},children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{style:{padding:"12px",textAlign:"left",borderBottom:"1px solid #d0d7de"},children:"集合名称"}),(0,n.jsx)("th",{style:{padding:"12px",textAlign:"left",borderBottom:"1px solid #d0d7de"},children:"向量数量"}),(0,n.jsx)("th",{style:{padding:"12px",textAlign:"left",borderBottom:"1px solid #d0d7de"},children:"操作"})]})}),(0,n.jsx)("tbody",{children:e.map((e,t)=>(0,n.jsxs)("tr",{style:{borderBottom:"1px solid #f1f3f4"},children:[(0,n.jsx)("td",{style:{padding:"12px"},children:e.name}),(0,n.jsx)("td",{style:{padding:"12px"},children:e.vectors_count||"N/A"}),(0,n.jsx)("td",{style:{padding:"12px"},children:(0,n.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,n.jsx)("button",{onClick:()=>L(e.name),disabled:a,style:{padding:"6px 12px",backgroundColor:"#9a6700",color:"white",border:"none",borderRadius:4,fontSize:"0.9em",cursor:a?"not-allowed":"pointer"},children:"\uD83D\uDD04 BM25"}),(0,n.jsx)("button",{onClick:()=>N(e.name),disabled:a,style:{padding:"6px 12px",backgroundColor:"#cf222e",color:"white",border:"none",borderRadius:4,fontSize:"0.9em",cursor:a?"not-allowed":"pointer"},children:"\uD83D\uDDD1️ 删除"})]})})]},t))})]})}):(0,n.jsx)("p",{style:{color:"#656d76",textAlign:"center",margin:0},children:"暂无集合，请先创建索引"})]})}),"index"===c&&(0,n.jsx)("section",{children:(0,n.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:20},children:[(0,n.jsxs)("div",{style:{border:"1px solid #e1e5e9",padding:20,borderRadius:12,backgroundColor:"#fafbfc"},children:[(0,n.jsx)("h3",{style:{color:"#24292f",marginBottom:16},children:"\uD83D\uDCDD 手动索引文档"}),(0,n.jsxs)("div",{style:{display:"grid",gap:12},children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{style:{display:"block",marginBottom:4,fontWeight:500},children:"集合名称"}),(0,n.jsx)("input",{value:p,onChange:e=>h(e.target.value),style:{width:"100%",padding:8,borderRadius:6,border:"1px solid #d0d7de"},placeholder:"输入集合名称"})]}),(0,n.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{style:{display:"block",marginBottom:4,fontWeight:500},children:"嵌入提供者"}),(0,n.jsxs)("select",{value:x,onChange:e=>f(e.target.value),style:{width:"100%",padding:8,borderRadius:6,border:"1px solid #d0d7de"},children:[(0,n.jsx)("option",{value:"qwen",children:"阿里千问"}),(0,n.jsx)("option",{value:"openai",children:"OpenAI"}),(0,n.jsx)("option",{value:"ollama",children:"Ollama"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{style:{display:"block",marginBottom:4,fontWeight:500},children:"模型名称"}),(0,n.jsx)("input",{value:g,onChange:e=>y(e.target.value),style:{width:"100%",padding:8,borderRadius:6,border:"1px solid #d0d7de"},placeholder:"如: text-embedding-v2"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{style:{display:"block",marginBottom:4,fontWeight:500},children:"文档内容 (用空行分隔)"}),(0,n.jsx)("textarea",{value:b,onChange:e=>m(e.target.value),style:{width:"100%",height:200,padding:8,borderRadius:6,border:"1px solid #d0d7de",resize:"vertical"},placeholder:"输入文档内容，用空行分隔不同文档..."})]}),(0,n.jsx)("button",{onClick:I,disabled:a,style:{padding:"12px 24px",backgroundColor:"#1a7f37",color:"white",border:"none",borderRadius:8,fontWeight:600,cursor:a?"not-allowed":"pointer",opacity:a?.6:1},children:a?"索引中...":"\uD83D\uDCDA 索引文档"})]})]}),(0,n.jsxs)("div",{style:{border:"1px solid #e1e5e9",padding:20,borderRadius:12,backgroundColor:"#fafbfc"},children:[(0,n.jsx)("h3",{style:{color:"#24292f",marginBottom:16},children:"\uD83C\uDF10 批量索引URL"}),(0,n.jsxs)("div",{style:{display:"grid",gap:12},children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{style:{display:"block",marginBottom:4,fontWeight:500},children:"集合名称"}),(0,n.jsx)("input",{value:p,onChange:e=>h(e.target.value),style:{width:"100%",padding:8,borderRadius:6,border:"1px solid #d0d7de"},placeholder:"输入集合名称"})]}),(0,n.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{style:{display:"block",marginBottom:4,fontWeight:500},children:"嵌入提供者"}),(0,n.jsxs)("select",{value:x,onChange:e=>f(e.target.value),style:{width:"100%",padding:8,borderRadius:6,border:"1px solid #d0d7de"},children:[(0,n.jsx)("option",{value:"qwen",children:"阿里千问"}),(0,n.jsx)("option",{value:"openai",children:"OpenAI"}),(0,n.jsx)("option",{value:"ollama",children:"Ollama"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{style:{display:"block",marginBottom:4,fontWeight:500},children:"模型名称"}),(0,n.jsx)("input",{value:g,onChange:e=>y(e.target.value),style:{width:"100%",padding:8,borderRadius:6,border:"1px solid #d0d7de"},placeholder:"如: text-embedding-v2"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{style:{display:"block",marginBottom:4,fontWeight:500},children:"URL列表 (每行一个)"}),(0,n.jsx)("textarea",{value:j,onChange:e=>v(e.target.value),style:{width:"100%",height:200,padding:8,borderRadius:6,border:"1px solid #d0d7de",resize:"vertical"},placeholder:"https://example.com/doc1 https://example.com/doc2 ..."})]}),(0,n.jsx)("button",{onClick:E,disabled:a,style:{padding:"12px 24px",backgroundColor:"#9a6700",color:"white",border:"none",borderRadius:8,fontWeight:600,cursor:a?"not-allowed":"pointer",opacity:a?.6:1},children:a?"索引中...":"\uD83C\uDF10 索引URL"})]})]})]})}),"evaluate"===c&&(0,n.jsx)("section",{children:(0,n.jsxs)("div",{style:{border:"1px solid #e1e5e9",padding:20,borderRadius:12,backgroundColor:"#fafbfc"},children:[(0,n.jsx)("h3",{style:{color:"#24292f",marginBottom:16},children:"\uD83D\uDCCA RAG检索质量评测"}),(0,n.jsxs)("div",{style:{display:"grid",gap:16},children:[(0,n.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:16},children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{style:{display:"block",marginBottom:4,fontWeight:500},children:"集合名称"}),(0,n.jsx)("input",{value:D,onChange:e=>C(e.target.value),style:{width:"100%",padding:8,borderRadius:6,border:"1px solid #d0d7de"},placeholder:"输入集合名称"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{style:{display:"block",marginBottom:4,fontWeight:500},children:"嵌入提供者"}),(0,n.jsxs)("select",{value:w,onChange:e=>k(e.target.value),style:{width:"100%",padding:8,borderRadius:6,border:"1px solid #d0d7de"},children:[(0,n.jsx)("option",{value:"qwen",children:"阿里千问"}),(0,n.jsx)("option",{value:"openai",children:"OpenAI"}),(0,n.jsx)("option",{value:"ollama",children:"Ollama"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{style:{display:"block",marginBottom:4,fontWeight:500},children:"TopK"}),(0,n.jsx)("input",{type:"number",min:"1",max:"20",value:R,onChange:e=>T(Number(e.target.value)),style:{width:"100%",padding:8,borderRadius:6,border:"1px solid #d0d7de"}})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{style:{display:"block",marginBottom:4,fontWeight:500},children:"评测样本 (JSON格式)"}),(0,n.jsx)("textarea",{value:A,onChange:e=>_(e.target.value),style:{width:"100%",height:200,padding:8,borderRadius:6,border:"1px solid #d0d7de",resize:"vertical"},placeholder:'[\n  {\n    "query": "查询语句1",\n    "relevant_ids": ["doc_id_1", "doc_id_2"]\n  },\n  {\n    "query": "查询语句2", \n    "relevant_ids": ["doc_id_3"]\n  }\n]'})]}),(0,n.jsx)("button",{onClick:W,disabled:a,style:{padding:"12px 24px",backgroundColor:"#cf222e",color:"white",border:"none",borderRadius:8,fontWeight:600,cursor:a?"not-allowed":"pointer",opacity:a?.6:1},children:a?"评测中...":"\uD83D\uDCCA 开始评测"})]})]})}),"results"===c&&(0,n.jsx)("section",{children:(0,n.jsxs)("div",{style:{border:"1px solid #e1e5e9",padding:20,borderRadius:12,backgroundColor:"#fafbfc"},children:[(0,n.jsx)("h3",{style:{color:"#24292f",marginBottom:16},children:"\uD83D\uDCC8 评测结果历史"}),(0,n.jsx)("div",{style:{display:"flex",gap:12,marginBottom:16},children:(0,n.jsx)("button",{onClick:P,disabled:a,style:{padding:"8px 16px",backgroundColor:"#0969da",color:"white",border:"none",borderRadius:6,cursor:a?"not-allowed":"pointer"},children:"\uD83D\uDD04 刷新结果"})}),r.length>0?(0,n.jsx)("div",{style:{background:"#ffffff",borderRadius:8,border:"1px solid #d0d7de",overflow:"hidden"},children:(0,n.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[(0,n.jsx)("thead",{style:{backgroundColor:"#f6f8fa"},children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{style:{padding:"12px",textAlign:"left",borderBottom:"1px solid #d0d7de"},children:"集合名称"}),(0,n.jsx)("th",{style:{padding:"12px",textAlign:"left",borderBottom:"1px solid #d0d7de"},children:"评测时间"}),(0,n.jsx)("th",{style:{padding:"12px",textAlign:"left",borderBottom:"1px solid #d0d7de"},children:"Recall@3"}),(0,n.jsx)("th",{style:{padding:"12px",textAlign:"left",borderBottom:"1px solid #d0d7de"},children:"Precision@3"}),(0,n.jsx)("th",{style:{padding:"12px",textAlign:"left",borderBottom:"1px solid #d0d7de"},children:"延迟P95"}),(0,n.jsx)("th",{style:{padding:"12px",textAlign:"left",borderBottom:"1px solid #d0d7de"},children:"操作"})]})}),(0,n.jsx)("tbody",{children:r.map((e,t)=>(0,n.jsxs)("tr",{style:{borderBottom:"1px solid #f1f3f4"},children:[(0,n.jsx)("td",{style:{padding:"12px"},children:e.collection}),(0,n.jsx)("td",{style:{padding:"12px"},children:new Date(e.timestamp).toLocaleString()}),(0,n.jsx)("td",{style:{padding:"12px"},children:(e.recall_at_3||0).toFixed(3)}),(0,n.jsx)("td",{style:{padding:"12px"},children:(e.precision_at_3||0).toFixed(3)}),(0,n.jsxs)("td",{style:{padding:"12px"},children:[(e.latency_p95||0).toFixed(2),"ms"]}),(0,n.jsx)("td",{style:{padding:"12px"},children:(0,n.jsx)("button",{onClick:()=>U(e.collection),style:{padding:"6px 12px",backgroundColor:"#8250df",color:"white",border:"none",borderRadius:4,fontSize:"0.9em",cursor:"pointer"},children:"\uD83D\uDCE5 CSV"})})]},t))})]})}):(0,n.jsx)("p",{style:{color:"#656d76",textAlign:"center",margin:0},children:"暂无评测结果，请先进行评测"})]})})]})}},2800:function(e,t,r){"use strict";r.d(t,{BC:function(){return s},FM:function(){return y},G4:function(){return f},Iu:function(){return l},KK:function(){return x},P4:function(){return u},R6:function(){return a},UP:function(){return d},XP:function(){return h},bG:function(){return c},of:function(){return g},s$:function(){return i},zK:function(){return p}});let n=r(357).env.NEXT_PUBLIC_API_BASE||"http://127.0.0.1:8000";async function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r="".concat(n).concat(e),o=localStorage.getItem("api_key"),i={"Content-Type":"application/json",...t.headers||{}};o&&(i["x-api-key"]=o);let d=await fetch(r,{...t,headers:i});if(!d.ok)throw Error("API调用失败: ".concat(d.status," ").concat(d.statusText));return d.json()}async function i(e,t){return o("/api/recommend",{method:"POST",body:JSON.stringify(t)})}async function d(e,t){let r=await fetch("".concat(e,"/api/recommend/export"),{method:"POST",headers:{"Content-Type":"application/json","x-api-key":localStorage.getItem("api_key")||""},body:JSON.stringify(t)});if(!r.ok)throw Error("导出失败: ".concat(r.status," ").concat(r.statusText));return r.text()}async function l(e,t){return o("/api/rag/index",{method:"POST",body:JSON.stringify(t)})}async function a(e,t){return o("/api/rag/search",{method:"POST",body:JSON.stringify(t)})}async function s(e,t){return o("/api/rag/evaluate",{method:"POST",body:JSON.stringify(t)})}async function c(e){return o("/api/rag/collections")}async function u(e,t){return o("/api/rag/collections/".concat(t),{method:"DELETE"})}async function p(e,t){return o("/api/rag/collections/".concat(t,"/reset-bm25"),{method:"POST"})}async function h(e){return o("/api/rag/evals")}async function x(e,t){let r=await fetch("".concat(e,"/api/rag/evals/").concat(t,".csv"),{headers:{"x-api-key":localStorage.getItem("api_key")||""}});if(!r.ok)throw Error("获取CSV失败: ".concat(r.status," ").concat(r.statusText));return r.text()}async function f(e,t){return o("/api/plan",{method:"POST",body:JSON.stringify(t)})}async function g(e){return o("/api/rubric")}async function y(e,t){return o("/api/llm/infer",{method:"POST",body:JSON.stringify(t)})}}},function(e){e.O(0,[971,23,744],function(){return e(e.s=821)}),_N_E=e.O()}]);