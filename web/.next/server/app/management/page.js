(()=>{var e={};e.id=393,e.ids=[393],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},9010:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>n.a,__next_app__:()=>u,originalPathname:()=>p,pages:()=>c,routeModule:()=>x,tree:()=>a}),r(4751),r(2029),r(5866);var i=r(3191),d=r(8716),o=r(7922),n=r.n(o),l=r(5231),s={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(s[e]=()=>l[e]);r.d(t,s);let a=["",{children:["management",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,4751)),"/Users/zhangjingxu/Desktop/ict-selection-assistant/web/src/app/management/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,2029)),"/Users/zhangjingxu/Desktop/ict-selection-assistant/web/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,5866,23)),"next/dist/client/components/not-found-error"]}],c=["/Users/zhangjingxu/Desktop/ict-selection-assistant/web/src/app/management/page.tsx"],p="/management/page",u={require:r,loadChunk:()=>Promise.resolve()},x=new i.AppPageRouteModule({definition:{kind:d.x.APP_PAGE,page:"/management/page",pathname:"/management",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:a}})},4894:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,2994,23)),Promise.resolve().then(r.t.bind(r,6114,23)),Promise.resolve().then(r.t.bind(r,9727,23)),Promise.resolve().then(r.t.bind(r,9671,23)),Promise.resolve().then(r.t.bind(r,1868,23)),Promise.resolve().then(r.t.bind(r,4759,23))},2642:()=>{},151:(e,t,r)=>{Promise.resolve().then(r.bind(r,512))},512:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>l});var i=r(326),d=r(7577),o=r(8069);let n=process.env.NEXT_PUBLIC_API_BASE||"http://127.0.0.1:8000";function l(){let[e,t]=(0,d.useState)([]),[r,l]=(0,d.useState)([]),[s,a]=(0,d.useState)(!1),[c,p]=(0,d.useState)("collections"),[u,x]=(0,d.useState)("ict_docs"),[h,g]=(0,d.useState)("qwen"),[y,m]=(0,d.useState)("text-embedding-v2"),[b,f]=(0,d.useState)(""),[j,v]=(0,d.useState)(""),[D,C]=(0,d.useState)("ict_docs"),[w,k]=(0,d.useState)("qwen"),[S,P]=(0,d.useState)("text-embedding-v2"),[_,R]=(0,d.useState)(3),[B,A]=(0,d.useState)("");async function O(){try{let e=await (0,o.bG)(n);t(e.collections||[])}catch(e){console.error("加载集合失败:",e)}}async function T(){try{let e=await (0,o.XP)(n);l(e.evals||[])}catch(e){console.error("加载评测结果失败:",e)}}async function I(){if(!b.trim()){alert("请输入要索引的文档内容");return}a(!0);try{let e=b.split("\n\n").filter(e=>e.trim()).map((e,t)=>({id:`doc_${Date.now()}_${t}`,text:e.trim(),meta:{source:"manual",timestamp:new Date().toISOString()}}));await (0,o.Iu)(n,{collection:u,provider:h,model:y,docs:e}),alert("文档索引完成！"),f(""),O()}catch(e){console.error("索引失败:",e),alert("索引失败，请检查API状态")}finally{a(!1)}}async function $(){if(!j.trim()){alert("请输入要索引的URL列表");return}a(!0);try{let e=j.split("\n").filter(e=>e.trim());await (0,o.Iu)(n,{collection:u,provider:h,model:y,urls:e}),alert("URL索引完成！"),v(""),O()}catch(e){console.error("索引失败:",e),alert("索引失败，请检查API状态")}finally{a(!1)}}async function q(e){if(confirm(`确定要删除集合 "${e}" 吗？此操作不可恢复！`)){a(!0);try{await (0,o.P4)(n,e),alert("集合删除成功！"),O()}catch(e){console.error("删除失败:",e),alert("删除失败，请检查API状态")}finally{a(!1)}}}async function N(e){if(confirm(`确定要重置集合 "${e}" 的BM25索引吗？`)){a(!0);try{await (0,o.zK)(n,e),alert("BM25索引重置成功！")}catch(e){console.error("重置失败:",e),alert("重置失败，请检查API状态")}finally{a(!1)}}}async function U(){if(!B.trim()){alert("请输入评测样本（JSON格式）");return}a(!0);try{let e;try{e=JSON.parse(B)}catch(e){alert("评测样本格式错误，请检查JSON格式");return}let t={collection:D,provider:w,model:S,topk:Number(_),samples:e};await (0,o.BC)(n,t),alert("评测完成！"),T()}catch(e){console.error("评测失败:",e),alert("评测失败，请检查API状态")}finally{a(!1)}}async function W(e){try{let t=await (0,o.KK)(n,e),r=new Blob([t],{type:"text/csv"}),i=window.URL.createObjectURL(r),d=document.createElement("a");d.href=i,d.download=`${e}_eval_${new Date().toISOString().split("T")[0]}.csv`,d.click(),window.URL.revokeObjectURL(i)}catch(e){console.error("下载失败:",e),alert("下载失败，请检查API状态")}}return(0,i.jsxs)("main",{style:{maxWidth:1400,margin:"0 auto",padding:24},children:[i.jsx("h1",{children:"\uD83D\uDD27 ICT选型助手 - 数据管理"}),i.jsx("div",{style:{marginBottom:24},children:i.jsx("div",{style:{display:"flex",gap:2,borderBottom:"1px solid #d0d7de"},children:[{id:"collections",name:"\uD83D\uDCDA 集合管理",icon:"\uD83D\uDCDA"},{id:"index",name:"\uD83D\uDCDD 文档索引",icon:"\uD83D\uDCDD"},{id:"evaluate",name:"\uD83D\uDCCA 质量评测",icon:"\uD83D\uDCCA"},{id:"results",name:"\uD83D\uDCC8 评测结果",icon:"\uD83D\uDCC8"}].map(e=>i.jsx("button",{onClick:()=>p(e.id),style:{padding:"12px 24px",border:"none",backgroundColor:c===e.id?"#0969da":"transparent",color:c===e.id?"white":"#656d76",borderRadius:"8px 8px 0 0",cursor:"pointer",fontWeight:c===e.id?600:400},children:e.name},e.id))})}),"collections"===c&&i.jsx("section",{children:(0,i.jsxs)("div",{style:{border:"1px solid #e1e5e9",padding:20,borderRadius:12,backgroundColor:"#fafbfc"},children:[i.jsx("h3",{style:{color:"#24292f",marginBottom:16},children:"\uD83D\uDCDA 向量集合管理"}),i.jsx("div",{style:{display:"flex",gap:12,marginBottom:16},children:i.jsx("button",{onClick:O,disabled:s,style:{padding:"8px 16px",backgroundColor:"#0969da",color:"white",border:"none",borderRadius:6,cursor:s?"not-allowed":"pointer"},children:"\uD83D\uDD04 刷新列表"})}),e.length>0?i.jsx("div",{style:{background:"#ffffff",borderRadius:8,border:"1px solid #d0d7de",overflow:"hidden"},children:(0,i.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[i.jsx("thead",{style:{backgroundColor:"#f6f8fa"},children:(0,i.jsxs)("tr",{children:[i.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"1px solid #d0d7de"},children:"集合名称"}),i.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"1px solid #d0d7de"},children:"向量数量"}),i.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"1px solid #d0d7de"},children:"操作"})]})}),i.jsx("tbody",{children:e.map((e,t)=>(0,i.jsxs)("tr",{style:{borderBottom:"1px solid #f1f3f4"},children:[i.jsx("td",{style:{padding:"12px"},children:e.name}),i.jsx("td",{style:{padding:"12px"},children:e.vectors_count||"N/A"}),i.jsx("td",{style:{padding:"12px"},children:(0,i.jsxs)("div",{style:{display:"flex",gap:8},children:[i.jsx("button",{onClick:()=>N(e.name),disabled:s,style:{padding:"6px 12px",backgroundColor:"#9a6700",color:"white",border:"none",borderRadius:4,fontSize:"0.9em",cursor:s?"not-allowed":"pointer"},children:"\uD83D\uDD04 BM25"}),i.jsx("button",{onClick:()=>q(e.name),disabled:s,style:{padding:"6px 12px",backgroundColor:"#cf222e",color:"white",border:"none",borderRadius:4,fontSize:"0.9em",cursor:s?"not-allowed":"pointer"},children:"\uD83D\uDDD1️ 删除"})]})})]},t))})]})}):i.jsx("p",{style:{color:"#656d76",textAlign:"center",margin:0},children:"暂无集合，请先创建索引"})]})}),"index"===c&&i.jsx("section",{children:(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:20},children:[(0,i.jsxs)("div",{style:{border:"1px solid #e1e5e9",padding:20,borderRadius:12,backgroundColor:"#fafbfc"},children:[i.jsx("h3",{style:{color:"#24292f",marginBottom:16},children:"\uD83D\uDCDD 手动索引文档"}),(0,i.jsxs)("div",{style:{display:"grid",gap:12},children:[(0,i.jsxs)("div",{children:[i.jsx("label",{style:{display:"block",marginBottom:4,fontWeight:500},children:"集合名称"}),i.jsx("input",{value:u,onChange:e=>x(e.target.value),style:{width:"100%",padding:8,borderRadius:6,border:"1px solid #d0d7de"},placeholder:"输入集合名称"})]}),(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[(0,i.jsxs)("div",{children:[i.jsx("label",{style:{display:"block",marginBottom:4,fontWeight:500},children:"嵌入提供者"}),(0,i.jsxs)("select",{value:h,onChange:e=>g(e.target.value),style:{width:"100%",padding:8,borderRadius:6,border:"1px solid #d0d7de"},children:[i.jsx("option",{value:"qwen",children:"阿里千问"}),i.jsx("option",{value:"openai",children:"OpenAI"}),i.jsx("option",{value:"ollama",children:"Ollama"})]})]}),(0,i.jsxs)("div",{children:[i.jsx("label",{style:{display:"block",marginBottom:4,fontWeight:500},children:"模型名称"}),i.jsx("input",{value:y,onChange:e=>m(e.target.value),style:{width:"100%",padding:8,borderRadius:6,border:"1px solid #d0d7de"},placeholder:"如: text-embedding-v2"})]})]}),(0,i.jsxs)("div",{children:[i.jsx("label",{style:{display:"block",marginBottom:4,fontWeight:500},children:"文档内容 (用空行分隔)"}),i.jsx("textarea",{value:b,onChange:e=>f(e.target.value),style:{width:"100%",height:200,padding:8,borderRadius:6,border:"1px solid #d0d7de",resize:"vertical"},placeholder:"输入文档内容，用空行分隔不同文档..."})]}),i.jsx("button",{onClick:I,disabled:s,style:{padding:"12px 24px",backgroundColor:"#1a7f37",color:"white",border:"none",borderRadius:8,fontWeight:600,cursor:s?"not-allowed":"pointer",opacity:s?.6:1},children:s?"索引中...":"\uD83D\uDCDA 索引文档"})]})]}),(0,i.jsxs)("div",{style:{border:"1px solid #e1e5e9",padding:20,borderRadius:12,backgroundColor:"#fafbfc"},children:[i.jsx("h3",{style:{color:"#24292f",marginBottom:16},children:"\uD83C\uDF10 批量索引URL"}),(0,i.jsxs)("div",{style:{display:"grid",gap:12},children:[(0,i.jsxs)("div",{children:[i.jsx("label",{style:{display:"block",marginBottom:4,fontWeight:500},children:"集合名称"}),i.jsx("input",{value:u,onChange:e=>x(e.target.value),style:{width:"100%",padding:8,borderRadius:6,border:"1px solid #d0d7de"},placeholder:"输入集合名称"})]}),(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[(0,i.jsxs)("div",{children:[i.jsx("label",{style:{display:"block",marginBottom:4,fontWeight:500},children:"嵌入提供者"}),(0,i.jsxs)("select",{value:h,onChange:e=>g(e.target.value),style:{width:"100%",padding:8,borderRadius:6,border:"1px solid #d0d7de"},children:[i.jsx("option",{value:"qwen",children:"阿里千问"}),i.jsx("option",{value:"openai",children:"OpenAI"}),i.jsx("option",{value:"ollama",children:"Ollama"})]})]}),(0,i.jsxs)("div",{children:[i.jsx("label",{style:{display:"block",marginBottom:4,fontWeight:500},children:"模型名称"}),i.jsx("input",{value:y,onChange:e=>m(e.target.value),style:{width:"100%",padding:8,borderRadius:6,border:"1px solid #d0d7de"},placeholder:"如: text-embedding-v2"})]})]}),(0,i.jsxs)("div",{children:[i.jsx("label",{style:{display:"block",marginBottom:4,fontWeight:500},children:"URL列表 (每行一个)"}),i.jsx("textarea",{value:j,onChange:e=>v(e.target.value),style:{width:"100%",height:200,padding:8,borderRadius:6,border:"1px solid #d0d7de",resize:"vertical"},placeholder:"https://example.com/doc1 https://example.com/doc2 ..."})]}),i.jsx("button",{onClick:$,disabled:s,style:{padding:"12px 24px",backgroundColor:"#9a6700",color:"white",border:"none",borderRadius:8,fontWeight:600,cursor:s?"not-allowed":"pointer",opacity:s?.6:1},children:s?"索引中...":"\uD83C\uDF10 索引URL"})]})]})]})}),"evaluate"===c&&i.jsx("section",{children:(0,i.jsxs)("div",{style:{border:"1px solid #e1e5e9",padding:20,borderRadius:12,backgroundColor:"#fafbfc"},children:[i.jsx("h3",{style:{color:"#24292f",marginBottom:16},children:"\uD83D\uDCCA RAG检索质量评测"}),(0,i.jsxs)("div",{style:{display:"grid",gap:16},children:[(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:16},children:[(0,i.jsxs)("div",{children:[i.jsx("label",{style:{display:"block",marginBottom:4,fontWeight:500},children:"集合名称"}),i.jsx("input",{value:D,onChange:e=>C(e.target.value),style:{width:"100%",padding:8,borderRadius:6,border:"1px solid #d0d7de"},placeholder:"输入集合名称"})]}),(0,i.jsxs)("div",{children:[i.jsx("label",{style:{display:"block",marginBottom:4,fontWeight:500},children:"嵌入提供者"}),(0,i.jsxs)("select",{value:w,onChange:e=>k(e.target.value),style:{width:"100%",padding:8,borderRadius:6,border:"1px solid #d0d7de"},children:[i.jsx("option",{value:"qwen",children:"阿里千问"}),i.jsx("option",{value:"openai",children:"OpenAI"}),i.jsx("option",{value:"ollama",children:"Ollama"})]})]}),(0,i.jsxs)("div",{children:[i.jsx("label",{style:{display:"block",marginBottom:4,fontWeight:500},children:"TopK"}),i.jsx("input",{type:"number",min:"1",max:"20",value:_,onChange:e=>R(Number(e.target.value)),style:{width:"100%",padding:8,borderRadius:6,border:"1px solid #d0d7de"}})]})]}),(0,i.jsxs)("div",{children:[i.jsx("label",{style:{display:"block",marginBottom:4,fontWeight:500},children:"评测样本 (JSON格式)"}),i.jsx("textarea",{value:B,onChange:e=>A(e.target.value),style:{width:"100%",height:200,padding:8,borderRadius:6,border:"1px solid #d0d7de",resize:"vertical"},placeholder:`[
  {
    "query": "查询语句1",
    "relevant_ids": ["doc_id_1", "doc_id_2"]
  },
  {
    "query": "查询语句2", 
    "relevant_ids": ["doc_id_3"]
  }
]`})]}),i.jsx("button",{onClick:U,disabled:s,style:{padding:"12px 24px",backgroundColor:"#cf222e",color:"white",border:"none",borderRadius:8,fontWeight:600,cursor:s?"not-allowed":"pointer",opacity:s?.6:1},children:s?"评测中...":"\uD83D\uDCCA 开始评测"})]})]})}),"results"===c&&i.jsx("section",{children:(0,i.jsxs)("div",{style:{border:"1px solid #e1e5e9",padding:20,borderRadius:12,backgroundColor:"#fafbfc"},children:[i.jsx("h3",{style:{color:"#24292f",marginBottom:16},children:"\uD83D\uDCC8 评测结果历史"}),i.jsx("div",{style:{display:"flex",gap:12,marginBottom:16},children:i.jsx("button",{onClick:T,disabled:s,style:{padding:"8px 16px",backgroundColor:"#0969da",color:"white",border:"none",borderRadius:6,cursor:s?"not-allowed":"pointer"},children:"\uD83D\uDD04 刷新结果"})}),r.length>0?i.jsx("div",{style:{background:"#ffffff",borderRadius:8,border:"1px solid #d0d7de",overflow:"hidden"},children:(0,i.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[i.jsx("thead",{style:{backgroundColor:"#f6f8fa"},children:(0,i.jsxs)("tr",{children:[i.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"1px solid #d0d7de"},children:"集合名称"}),i.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"1px solid #d0d7de"},children:"评测时间"}),i.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"1px solid #d0d7de"},children:"Recall@3"}),i.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"1px solid #d0d7de"},children:"Precision@3"}),i.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"1px solid #d0d7de"},children:"延迟P95"}),i.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"1px solid #d0d7de"},children:"操作"})]})}),i.jsx("tbody",{children:r.map((e,t)=>(0,i.jsxs)("tr",{style:{borderBottom:"1px solid #f1f3f4"},children:[i.jsx("td",{style:{padding:"12px"},children:e.collection}),i.jsx("td",{style:{padding:"12px"},children:new Date(e.timestamp).toLocaleString()}),i.jsx("td",{style:{padding:"12px"},children:(e.recall_at_3||0).toFixed(3)}),i.jsx("td",{style:{padding:"12px"},children:(e.precision_at_3||0).toFixed(3)}),(0,i.jsxs)("td",{style:{padding:"12px"},children:[(e.latency_p95||0).toFixed(2),"ms"]}),i.jsx("td",{style:{padding:"12px"},children:i.jsx("button",{onClick:()=>W(e.collection),style:{padding:"6px 12px",backgroundColor:"#8250df",color:"white",border:"none",borderRadius:4,fontSize:"0.9em",cursor:"pointer"},children:"\uD83D\uDCE5 CSV"})})]},t))})]})}):i.jsx("p",{style:{color:"#656d76",textAlign:"center",margin:0},children:"暂无评测结果，请先进行评测"})]})})]})}},8069:(e,t,r)=>{"use strict";r.d(t,{BC:()=>a,FM:()=>m,G4:()=>g,Iu:()=>l,KK:()=>h,P4:()=>p,R6:()=>s,UP:()=>n,XP:()=>x,bG:()=>c,of:()=>y,s$:()=>o,zK:()=>u});let i=process.env.NEXT_PUBLIC_API_BASE||"http://127.0.0.1:8000";async function d(e,t={}){let r=`${i}${e}`,d=localStorage.getItem("api_key"),o={"Content-Type":"application/json",...t.headers||{}};d&&(o["x-api-key"]=d);let n=await fetch(r,{...t,headers:o});if(!n.ok)throw Error(`API调用失败: ${n.status} ${n.statusText}`);return n.json()}async function o(e,t){return d("/api/recommend",{method:"POST",body:JSON.stringify(t)})}async function n(e,t){let r=await fetch(`${e}/api/recommend/export`,{method:"POST",headers:{"Content-Type":"application/json","x-api-key":localStorage.getItem("api_key")||""},body:JSON.stringify(t)});if(!r.ok)throw Error(`导出失败: ${r.status} ${r.statusText}`);return r.text()}async function l(e,t){return d("/api/rag/index",{method:"POST",body:JSON.stringify(t)})}async function s(e,t){return d("/api/rag/search",{method:"POST",body:JSON.stringify(t)})}async function a(e,t){return d("/api/rag/evaluate",{method:"POST",body:JSON.stringify(t)})}async function c(e){return d("/api/rag/collections")}async function p(e,t){return d(`/api/rag/collections/${t}`,{method:"DELETE"})}async function u(e,t){return d(`/api/rag/collections/${t}/reset-bm25`,{method:"POST"})}async function x(e){return d("/api/rag/evals")}async function h(e,t){let r=await fetch(`${e}/api/rag/evals/${t}.csv`,{headers:{"x-api-key":localStorage.getItem("api_key")||""}});if(!r.ok)throw Error(`获取CSV失败: ${r.status} ${r.statusText}`);return r.text()}async function g(e,t){return d("/api/plan",{method:"POST",body:JSON.stringify(t)})}async function y(e){return d("/api/rubric")}async function m(e,t){return d("/api/llm/infer",{method:"POST",body:JSON.stringify(t)})}},2029:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>o,metadata:()=>d});var i=r(9510);r(5023),r(1159);let d={title:"ICT 选型助手 \xb7 参数化规划",description:"基于业务场景的参数化扩容建议与 RAM/RAG 评估"};function o({children:e}){return i.jsx("html",{lang:"zh-CN",children:i.jsx("body",{children:e})})}},4751:(e,t,r)=>{"use strict";r.r(t),r.d(t,{$$typeof:()=>n,__esModule:()=>o,default:()=>l});var i=r(8570);let d=(0,i.createProxy)(String.raw`/Users/zhangjingxu/Desktop/ict-selection-assistant/web/src/app/management/page.tsx`),{__esModule:o,$$typeof:n}=d;d.default;let l=(0,i.createProxy)(String.raw`/Users/zhangjingxu/Desktop/ict-selection-assistant/web/src/app/management/page.tsx#default`)},5023:()=>{}};var t=require("../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[819],()=>r(9010));module.exports=i})();